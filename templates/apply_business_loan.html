{% extends "base.html" %}

{% block title %}Apply Business Loan - YourBank{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0">Business Loan Application</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <strong>Loan Features:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Loan Amount: Up to ₹50 Lakhs (₹2 Crores for Premium Current Account)</li>
                            <li>Interest Rate: 11% p.a.</li>
                            <li>Processing Fee: 1.5% (deducted from loan amount)</li>
                            <li>For Manufacturing, Trading, or Service businesses</li>
                        </ul>
                    </div>

                    <form method="POST" action="{{ url_for('submit_loan_application') }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <input type="hidden" name="loan_type" value="business">

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="loan_amount">Loan Amount (₹) *</label>
                                    <input type="number" class="form-control" id="loan_amount" name="loan_amount" 
                                           min="100000" max="5000000" step="1000" required>
                                    <small class="form-text text-muted">Maximum: ₹50,00,000 (₹2 Crores for Premium)</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="tenure_months">Loan Tenure (Years) *</label>
                                    <select class="form-control" id="tenure_months" name="tenure_months" required>
                                        <option value="">Select Tenure</option>
                                        <option value="12">1 Year</option>
                                        <option value="24">2 Years</option>
                                        <option value="36">3 Years</option>
                                        <option value="48">4 Years</option>
                                        <option value="60">5 Years</option>
                                        <option value="84">7 Years</option>
                                        <option value="120">10 Years</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="business_type">Business Type *</label>
                                    <select class="form-control" id="business_type" name="business_type" required>
                                        <option value="">Select Business Type</option>
                                        <option value="MANUFACTURING">Manufacturing</option>
                                        <option value="TRADING">Trading</option>
                                        <option value="SERVICES">Services</option>
                                        <option value="RETAIL">Retail</option>
                                        <option value="WHOLESALE">Wholesale</option>
                                        <option value="EXPORT_IMPORT">Export/Import</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="company_name">Company/Business Name *</label>
                                    <input type="text" class="form-control" id="company_name" name="company_name" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="annual_income">Annual Income (ITR) (₹) *</label>
                                    <input type="number" class="form-control" id="annual_income" name="annual_income" 
                                           min="150000" required>
                                    <small class="form-text text-muted">Minimum: ₹1,50,000</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="business_turnover">Business Turnover (₹) *</label>
                                    <input type="number" class="form-control" id="business_turnover" name="business_turnover" 
                                           min="4000000" required>
                                    <small class="form-text text-muted">Minimum: ₹40,00,000</small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="business_vintage">Business Vintage (Years) *</label>
                                    <select class="form-control" id="business_vintage" name="business_vintage" required>
                                        <option value="">Select Years</option>
                                        <option value="1">1 Year</option>
                                        <option value="2">2 Years</option>
                                        <option value="3">3 Years</option>
                                        <option value="5">5+ Years</option>
                                        <option value="10">10+ Years</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="entity_type">Entity Type *</label>
                                    <select class="form-control" id="entity_type" name="entity_type" required>
                                        <option value="">Select Entity Type</option>
                                        <option value="PROPRIETORSHIP">Sole Proprietorship</option>
                                        <option value="PARTNERSHIP">Partnership Firm</option>
                                        <option value="PRIVATE_LIMITED">Private Limited Company</option>
                                        <option value="PUBLIC_LIMITED">Public Limited Company</option>
                                        <option value="LLP">Limited Liability Partnership</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nationality">Nationality *</label>
                                    <select class="form-control" id="nationality" name="nationality" required>
                                        <option value="Indian">Indian</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="age">Age *</label>
                                    <input type="number" class="form-control" id="age" name="age" 
                                           min="21" max="65" required>
                                    <small class="form-text text-muted">Age: 21-65 years</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="loan_purpose">Loan Purpose *</label>
                            <select class="form-control" id="loan_purpose" name="loan_purpose" required>
                                <option value="">Select Purpose</option>
                                <option value="WORKING_CAPITAL">Working Capital</option>
                                <option value="EQUIPMENT_PURCHASE">Equipment Purchase</option>
                                <option value="BUSINESS_EXPANSION">Business Expansion</option>
                                <option value="INVENTORY">Inventory Purchase</option>
                                <option value="OFFICE_SETUP">Office Setup</option>
                                <option value="OTHER">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="terms" required>
                                <label class="form-check-label" for="terms">
                                    I agree to the <a href="#" target="_blank">Terms and Conditions</a> and authorize YourBank to verify my business information and financial documents.
                                </label>
                            </div>
                        </div>

                        <div class="form-group text-center">
                            <button type="submit" class="btn btn-warning btn-lg">Submit Application</button>
                            <a href="{{ url_for('loans') }}" class="btn btn-secondary btn-lg ml-2">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('loan_amount').addEventListener('input', function() {
    const amount = parseInt(this.value);
    const tenure = document.getElementById('tenure_months').value;
    
    if (amount && tenure) {
        const monthlyRate = 11 / (12 * 100);
        const emi = Math.round(amount * monthlyRate * Math.pow(1 + monthlyRate, tenure) / (Math.pow(1 + monthlyRate, tenure) - 1));
        const processingFee = Math.round(amount * 0.015);
        const disbursedAmount = amount - processingFee;
        
        document.getElementById('emi-info').innerHTML = `
            <div class="alert alert-success">
                <strong>Loan Summary:</strong><br>
                Processing Fee: ₹${processingFee.toLocaleString()}<br>
                Amount to be disbursed: ₹${disbursedAmount.toLocaleString()}<br>
                Monthly EMI: ₹${emi.toLocaleString()}
            </div>
        `;
    }
});

document.getElementById('tenure_months').addEventListener('change', function() {
    document.getElementById('loan_amount').dispatchEvent(new Event('input'));
});
</script>

<div id="emi-info"></div>
{% endblock %}