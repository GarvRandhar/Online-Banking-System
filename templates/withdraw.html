{% extends 'base.html' %}

{% block title %}Withdraw Money | SecureBank Pro{% endblock %}

{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-5">
      <div class="page-header text-center animate__animated animate__fadeInDown">
        <h1 class="page-title">Withdraw Money</h1>
        <p class="page-subtitle">Withdraw cash from your account</p>
      </div>

      <div class="modern-form">
        <div class="card border-0 shadow-lg animate__animated animate__fadeInUp">
          <div class="card-body p-5">
            <!-- Header -->
            <div class="text-center mb-4">
              <div class="feature-icon-modern danger mx-auto mb-3" style="width: 60px; height: 60px;">
                <i class="fas fa-minus"></i>
              </div>
              <h3 class="h4 mb-2">Make a Withdrawal</h3>
              <p class="text-muted">Ensure sufficient balance before proceeding</p>
            </div>

            <!-- Form -->
            <form method="POST" id="withdrawForm" novalidate>
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              
              <div class="form-floating mb-4">
                <input type="number" name="amount" id="amount" class="form-control form-control-lg" 
                      placeholder="Amount" min="1" max="50000" step="0.01" required>
                <label for="amount">
                  <i class="fas fa-rupee-sign me-2"></i>Amount to Withdraw
                </label>
                <div class="form-text">Maximum withdrawal: ₹50,000 per transaction</div>
              </div>

              <!-- Quick Amount Buttons -->
              <div class="mb-4">
                <h6 class="text-muted mb-2">Quick amounts:</h6>
                <div class="d-flex gap-2 flex-wrap">
                  <button type="button" class="btn btn-outline-danger btn-sm quick-amount" data-amount="500">₹500</button>
                  <button type="button" class="btn btn-outline-danger btn-sm quick-amount" data-amount="1000">₹1,000</button>
                  <button type="button" class="btn btn-outline-danger btn-sm quick-amount" data-amount="2000">₹2,000</button>
                  <button type="button" class="btn btn-outline-danger btn-sm quick-amount" data-amount="5000">₹5,000</button>
                </div>
              </div>

              <!-- Warning Card -->
              <div class="card border-warning bg-warning bg-opacity-10 mb-4">
                <div class="card-body p-3">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                    <small class="text-dark">
                      Please ensure you have sufficient funds in your account
                    </small>
                  </div>
                </div>
              </div>
              
              <div class="d-grid mb-3">
                <button type="submit" class="btn btn-danger btn-lg">
                  <i class="fas fa-hand-holding-usd me-2"></i>Withdraw Money
                </button>
              </div>
            </form>

            <!-- Back Link -->
            <div class="text-center border-top pt-3">
              <a href="{{ url_for('dashboard') }}" class="text-decoration-none">
                <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
              </a>
            </div>
          </div>
        </div>

        <!-- Security Notice -->
        <div class="card border-0 bg-light mt-3">
          <div class="card-body p-3">
            <div class="d-flex align-items-center">
              <i class="fas fa-shield-alt text-success me-2"></i>
              <small class="text-muted">
                All withdrawals are processed securely and instantly
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Quick amount buttons
  document.querySelectorAll('.quick-amount').forEach(button => {
    button.addEventListener('click', function() {
      const amount = this.getAttribute('data-amount');
      document.getElementById('amount').value = amount;
      
      // Remove active class from all buttons
      document.querySelectorAll('.quick-amount').forEach(btn => btn.classList.remove('active'));
      // Add active class to clicked button
      this.classList.add('active');
    });
  });

  // Enhanced form validation
  document.getElementById('withdrawForm').addEventListener('submit', function(event) {
    const amount = document.getElementById('amount').value;
    
    // Remove previous error states
    document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
    
    let hasError = false;
    
    // Check if amount is valid
    if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
      document.getElementById('amount').classList.add('is-invalid');
      hasError = true;
    }
    
    // Check withdrawal limit
    if (parseFloat(amount) > 50000) {
      document.getElementById('amount').classList.add('is-invalid');
      hasError = true;
    }
    
    if (hasError) {
      event.preventDefault();
      return false;
    }
    
    return true;
  });
  
  // Format amount input and real-time validation
  document.getElementById('amount').addEventListener('input', function() {
    const value = parseFloat(this.value);
    
    // Remove invalid class if value is valid
    if (value && !isNaN(value) && value > 0 && value <= 50000) {
      this.classList.remove('is-invalid');
    }
  });
</script>
{% endblock %}