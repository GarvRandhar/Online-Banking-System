<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Payments</title>
</head>
<body>
    {% extends 'base.html' %}

    {% block title %}Bulk Payments | SecureBank Pro{% endblock %}

    {% block content %}
    <div class="container">
      <div class="page-header text-center animate__animated animate__fadeInDown">
        <h1 class="page-title">Bulk Payments</h1>
        <p class="page-subtitle">Process multiple payments efficiently with secure file uploads</p>
      </div>
  
      <div class="row justify-content-center">
        <div class="col-xl-10">
          
          <!-- Process Flow -->
          <div class="progress-steps animate__animated animate__fadeInUp">
            <div class="progress-step">
              <div class="step-circle active">1</div>
              <div class="step-line"></div>
            </div>
            <div class="progress-step">
              <div class="step-circle">2</div>
              <div class="step-line"></div>
            </div>
            <div class="progress-step">
              <div class="step-circle">3</div>
            </div>
          </div>
          
          <div class="text-center mb-4">
            <h6 class="text-muted">Upload File → Review → Process Payments</h6>
          </div>
  
          <!-- File Upload Section -->
          <div class="card border-0 shadow-lg mb-4 animate__animated animate__fadeInUp animate__delay-1s">
            <div class="card-body p-5">
              <div class="text-center mb-4">
                <div class="business-icon mx-auto mb-3">
                  <i class="fas fa-upload"></i>
                </div>
                <h3 class="h4 mb-2">Upload Payment File</h3>
                <p class="text-muted">Upload Excel or CSV file with payment details</p>
              </div>
  
              <form method="POST" enctype="multipart/form-data" id="bulkPaymentForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <!-- File Upload Area -->
                <div class="file-upload-area" id="fileUploadArea">
                  <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                  </div>
                  <p class="upload-text">Drag & drop your file here</p>
                  <p class="upload-subtext">or click to browse</p>
                  <input type="file" name="payment_file" id="paymentFile" 
                         class="file-input" accept=".csv,.xlsx,.xls" required>
                </div>
  
                <!-- File Info Display -->
                <div id="fileInfo" class="mt-3 d-none">
                  <div class="alert alert-modern alert-success">
                    <div class="d-flex align-items-center">
                      <i class="fas fa-file-check me-3"></i>
                      <div>
                        <strong>File Selected:</strong> <span id="fileName"></span><br>
                        <small>Size: <span id="fileSize"></span> | Type: <span id="fileType"></span></small>
                      </div>
                    </div>
                  </div>
                </div>
  
                <!-- Upload Button -->
                <div class="d-grid mt-4">
                  <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-upload me-2"></i>Upload & Process File
                  </button>
                </div>
              </form>
            </div>
          </div>
  
          <!-- File Format Guide -->
          <div class="business-features-grid animate__animated animate__fadeInUp animate__delay-2s">
            <div class="business-feature-card">
              <div class="business-icon">
                <i class="fas fa-file-excel"></i>
              </div>
              <h5 class="mb-3">Supported Formats</h5>
              <ul class="list-unstyled">
                <li><i class="fas fa-check-circle text-success me-2"></i>Excel (.xlsx, .xls)</li>
                <li><i class="fas fa-check-circle text-success me-2"></i>CSV (.csv)</li>
                <li><i class="fas fa-info-circle text-info me-2"></i>Max file size: 10MB</li>
              </ul>
            </div>
  
            <div class="business-feature-card">
              <div class="business-icon" style="background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);">
                <i class="fas fa-table"></i>
              </div>
              <h5 class="mb-3">Required Columns</h5>
              <ul class="list-unstyled text-sm">
                <li><strong>Account Number:</strong> 10-digit account</li>
                <li><strong>Amount:</strong> Payment amount</li>
                <li><strong>Description:</strong> Payment note</li>
                <li><strong>Reference:</strong> Transaction ID</li>
              </ul>
            </div>
  
            <div class="business-feature-card">
              <div class="business-icon" style="background: linear-gradient(135deg, var(--warning) 0%, #fbbf24 100%);">
                <i class="fas fa-shield-alt"></i>
              </div>
              <h5 class="mb-3">Security Features</h5>
              <ul class="list-unstyled">
                <li><i class="fas fa-lock text-warning me-2"></i>Encrypted file processing</li>
                <li><i class="fas fa-eye text-warning me-2"></i>Review before execution</li>
                <li><i class="fas fa-history text-warning me-2"></i>Complete audit trail</li>
              </ul>
            </div>
          </div>
  
          <!-- Sample Template Download -->
          <div class="text-center mt-5 animate__animated animate__fadeInUp animate__delay-3s">
            <div class="card border-0 bg-light">
              <div class="card-body p-4">
                <h6 class="mb-3">Need a template?</h6>
                <p class="text-muted mb-3">Download our sample template to get started quickly</p>
                <div class="d-flex gap-2 justify-content-center flex-wrap">
                  <a href="{{ url_for('download_template', template_type='excel') }}" 
                     class="btn btn-outline-primary template-download-btn">
                    <i class="fas fa-download me-2"></i>Download Excel Template
                  </a>
                  <a href="{{ url_for('download_template', template_type='csv') }}" 
                     class="btn btn-outline-secondary template-download-btn">
                    <i class="fas fa-download me-2"></i>Download CSV Template
                  </a>
                </div>
                
                <!-- Template Info -->
                <div class="mt-3">
                  <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Templates include sample data to help you format your payment files correctly
                  </small>
                </div>
              </div>
            </div>
          </div>
  
          <!-- Recent Bulk Payments -->
          <div class="card border-0 shadow-sm mt-5 animate__animated animate__fadeInUp animate__delay-4s">
            <div class="card-header bg-transparent">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                  <i class="fas fa-history me-2 text-primary"></i>Recent Bulk Payments
                </h5>
                <button class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="text-center py-5 text-muted">
                <i class="fas fa-inbox fa-3x mb-3 opacity-50"></i>
                <p class="mb-0">No bulk payment history found</p>
                <small>Your processed bulk payments will appear here</small>
              </div>
            </div>
          </div>
  
          <!-- Back Link -->
          <div class="text-center mt-4">
            <a href="{{ url_for('current_account_dashboard') }}" class="text-decoration-none">
              <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
            </a>
          </div>
        </div>
      </div>
    </div>
  
    <script>
      // File upload handling
      const fileInput = document.getElementById('paymentFile');
      const fileUploadArea = document.getElementById('fileUploadArea');
      const fileInfo = document.getElementById('fileInfo');
  
      // Click to upload
      fileUploadArea.addEventListener('click', () => fileInput.click());
  
      // Drag and drop functionality
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, preventDefaults, false);
      });
  
      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }
  
      ['dragenter', 'dragover'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, () => {
          fileUploadArea.classList.add('dragover');
        });
      });
  
      ['dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, () => {
          fileUploadArea.classList.remove('dragover');
        });
      });
  
      fileUploadArea.addEventListener('drop', handleDrop);
  
      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        fileInput.files = files;
        handleFileSelect();
      }
  
      // File selection handling
      fileInput.addEventListener('change', handleFileSelect);
  
      function handleFileSelect() {
        const file = fileInput.files[0];
        if (file) {
          const fileName = file.name;
          const fileSize = formatFileSize(file.size);
          const fileType = file.type || 'Unknown';
  
          document.getElementById('fileName').textContent = fileName;
          document.getElementById('fileSize').textContent = fileSize;
          document.getElementById('fileType').textContent = fileType;
  
          fileInfo.classList.remove('d-none');
        }
      }
  
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
  
      // Form submission
      document.getElementById('bulkPaymentForm').addEventListener('submit', function(e) {
        if (!fileInput.files || fileInput.files.length === 0) {
          e.preventDefault();
          alert('Please select a file to upload');
          return false;
        }
        
        // Show loading state
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
        submitBtn.disabled = true;
        
        return true;
      });
    </script>
    {% endblock %}
</body>
</html>