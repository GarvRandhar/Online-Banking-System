{% extends "base.html" %}

{% block title %}Apply Personal Loan - YourBank{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Personal Loan Application</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <strong>Loan Features:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Loan Amount: ₹1 Lakh to ₹35 Lakhs</li>
                            <li>Interest Rate: 12% p.a.</li>
                            <li>Processing Fee: 2% (deducted from loan amount)</li>
                            <li>No Security, No Guarantor Required</li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-warning">
                        <strong>Strict Eligibility Criteria:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Age: 21-60 years</li>
                            <li>Minimum 2 years employment experience</li>
                            <li>Credit Score: 650+ required</li>
                            <li>Maximum 2 existing loans allowed</li>
                            <li>EMI should not exceed 50% of monthly income</li>
                            <li>Processing time: 24-48 hours</li>
                        </ul>
                    </div>

                    <form method="POST" action="{{ url_for('submit_loan_application') }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <input type="hidden" name="loan_type" value="personal">

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="loan_amount">Loan Amount (₹) *</label>
                                    <input type="number" class="form-control" id="loan_amount" name="loan_amount" 
                                           min="100000" max="3500000" step="1000" required>
                                    <small class="form-text text-muted">Minimum: ₹1,00,000 | Maximum: ₹35,00,000</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="tenure_months">Loan Tenure (Months) *</label>
                                    <select class="form-control" id="tenure_months" name="tenure_months" required>
                                        <option value="">Select Tenure</option>
                                        <option value="12">12 Months</option>
                                        <option value="24">24 Months</option>
                                        <option value="36">36 Months</option>
                                        <option value="48">48 Months</option>
                                        <option value="60">60 Months</option>
                                        <option value="72">72 Months</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="employment_type">Employment Type *</label>
                                    <select class="form-control" id="employment_type" name="employment_type" required>
                                        <option value="">Select Employment Type</option>
                                        <option value="GOVERNMENT">Government Sector</option>
                                        <option value="DEFENCE">Defence Sector</option>
                                        <option value="CORPORATE">Corporate Sector</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="company_name">Company/Organization Name *</label>
                                    <input type="text" class="form-control" id="company_name" name="company_name" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="monthly_salary">Monthly Net Salary (₹) *</label>
                                    <input type="number" class="form-control" id="monthly_salary" name="monthly_salary" 
                                           min="20000" required>
                                    <small class="form-text text-muted">
                                        Govt/Defence: Min ₹20,000 | Corporate: Min ₹25,000
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="employment_years">Years of Employment *</label>
                                    <select class="form-control" id="employment_years" name="employment_years" required>
                                        <option value="">Select Experience</option>
                                        <option value="1">1 Year</option>
                                        <option value="2">2 Years</option>
                                        <option value="3">3 Years</option>
                                        <option value="5">5 Years</option>
                                        <option value="10">10+ Years</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="credit_score">Credit Score *</label>
                                    <input type="number" class="form-control" id="credit_score" name="credit_score" 
                                           min="300" max="850" required>
                                    <small class="form-text text-muted">Your CIBIL score (300-850). Minimum 650 required.</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="existing_loans">Number of Existing Loans *</label>
                                    <select class="form-control" id="existing_loans" name="existing_loans" required>
                                        <option value="0">No existing loans</option>
                                        <option value="1">1 existing loan</option>
                                        <option value="2">2 existing loans</option>
                                        <option value="3">3 or more loans</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nationality">Nationality *</label>
                                    <select class="form-control" id="nationality" name="nationality" required>
                                        <option value="Indian">Indian</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="terms" required>
                                <label class="form-check-label" for="terms">
                                    I agree to the <a href="#" target="_blank">Terms and Conditions</a> and authorize YourBank to verify my information.
                                </label>
                            </div>
                        </div>

                        <div class="form-group text-center">
                            <button type="submit" class="btn btn-primary btn-lg">Submit Application</button>
                            <a href="{{ url_for('loans') }}" class="btn btn-secondary btn-lg ml-2">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('loan_amount').addEventListener('input', function() {
    const amount = parseInt(this.value);
    const tenure = document.getElementById('tenure_months').value;
    
    if (amount && tenure) {
        const monthlyRate = 12 / (12 * 100);
        const emi = Math.round(amount * monthlyRate * Math.pow(1 + monthlyRate, tenure) / (Math.pow(1 + monthlyRate, tenure) - 1));
        const processingFee = Math.round(amount * 0.02);
        const disbursedAmount = amount - processingFee;
        
        document.getElementById('emi-info').innerHTML = `
            <div class="alert alert-success">
                <strong>Loan Summary:</strong><br>
                Processing Fee: ₹${processingFee.toLocaleString()}<br>
                Amount to be disbursed: ₹${disbursedAmount.toLocaleString()}<br>
                Monthly EMI: ₹${emi.toLocaleString()}
            </div>
        `;
    }
});

document.getElementById('tenure_months').addEventListener('change', function() {
    document.getElementById('loan_amount').dispatchEvent(new Event('input'));
});
</script>

<div id="emi-info"></div>
{% endblock %}